<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ma tr·∫≠n PLO-Course</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Th∆∞ vi·ªán c·∫ßn d√πng -->
  <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="sticky top-0 bg-white/90 backdrop-blur border-b">
    <nav class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="./index.html" class="font-bold text-lg">Curriculum Matrices</a>
      <ul class="flex gap-4 text-sm" id="topnav">
        <li><a href="./plo-pi.html" data-nav="plo-pi" class="nav-link">PLO-PI</a></li>
        <li><a href="./plo-course.html" data-nav="plo-course" class="nav-link">PLO-Course</a></li>
        <li><a href="./clo-plo.html" data-nav="clo-plo" class="nav-link">CLO-PLO</a></li>
        <li><a href="./phan-bo-khung.html" data-nav="phan-bo-khung" class="nav-link">Ph√¢n b·ªï khung</a></li>
      </ul>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8 space-y-6">
    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-semibold">Ma tr·∫≠n PLO-Course</h1>
      <div class="text-sm text-gray-500">/plo-course.html</div>
    </div>

    <div id="app-plo-course" class="card p-4 space-y-6">
      <div class="grid lg:grid-cols-3 gap-4">
        <!-- Panel tr√°i: n·∫°p CSV + thao t√°c k·∫øt n·ªëi + l∆∞u/kh√¥i ph·ª•c -->
        <div class="space-y-4">
          <div class="space-y-2">
            <h3 class="font-semibold">N·∫°p d·ªØ li·ªáu CSV</h3>
            <label class="block text-sm">PLO.csv (label,content)
              <input type="file" id="ploCsvInput" accept=".csv" class="mt-1 block w-full text-sm">
            </label>
            <label class="block text-sm">COURSE.csv (id,label,fullname,group)
              <input type="file" id="courseCsvInput" accept=".csv" class="mt-1 block w-full text-sm">
            </label>
            <button id="btnBuild" class="btn">X√¢y ƒë·ªì th·ªã</button>
            <div id="buildStatus" class="text-xs text-gray-500"></div>
          </div>

          <hr>

          <div class="space-y-2">
            <h3 class="font-semibold">Th√™m k·∫øt n·ªëi PLO ‚Üí Course</h3>
            <div class="grid grid-cols-1 gap-2 text-sm">
              <label>PLO (label)
                <select id="plo-add" class="mt-1 w-full border rounded p-1"></select>
              </label>
              <label>Course (id ‚Äî label/fullname)
                <select id="hp-add" class="mt-1 w-full border rounded p-1"></select>
              </label>
              <label>M·ª©c ƒë·ªô (I/R/M/A)
                <select id="level-add" class="mt-1 w-full border rounded p-1">
                  <option>I</option><option>R</option><option>M</option><option>A</option>
                </select>
              </label>
              <button id="btnAdd" class="btn">Th√™m k·∫øt n·ªëi</button>
            </div>
          </div>

          <hr>

          <div class="space-y-2">
            <h3 class="font-semibold">Ch·ªânh s·ª≠a k·∫øt n·ªëi ƒëang ch·ªçn</h3>
            <div class="grid grid-cols-1 gap-2 text-sm">
              <label>M·ª©c ƒë·ªô
                <select id="level-select" class="mt-1 w-full border rounded p-1">
                  <option>I</option><option>R</option><option>M</option><option>A</option>
                </select>
              </label>
              <div class="flex flex-wrap gap-2">
                <button id="btnUpdateLevel" class="btn">C·∫≠p nh·∫≠t m·ª©c ƒë·ªô</button>
                <button id="btnDelete" class="btn">Xo√° k·∫øt n·ªëi</button>
                <button id="btnUndo" class="btn">Ho√†n t√°c xo√°</button>
              </div>
            </div>
          </div>

          <hr>

          <div class="space-y-2">
            <h3 class="font-semibold">Nh·∫≠p/Xu·∫•t k·∫øt n·ªëi</h3>
            <div class="flex flex-col gap-2 text-sm">
              <button id="btnExportCSV" class="btn">Xu·∫•t CSV (plo_label,course_id,level)</button>
              <label>Nh·∫≠p CSV k·∫øt n·ªëi
                <input type="file" id="connCsvInput" accept=".csv" class="mt-1 block w-full text-sm">
              </label>
            </div>
            <div class="flex flex-col gap-2 text-sm">
              <div class="flex flex-wrap gap-2">
                <button id="btnExportJSON" class="btn">Xu·∫•t JSON</button>
                <button id="btnImportJSON" class="btn">Nh·∫≠p JSON</button>
                <input type="file" id="jsonInput" accept=".json" class="hidden">
              </div>
            </div>
          </div>

          <hr>

          <div class="space-y-2">
            <h3 class="font-semibold">L∆∞u/Kh√¥i ph·ª•c (tr√¨nh duy·ªát)</h3>
            <div class="flex flex-wrap gap-2 text-sm">
              <button id="btnSaveLS" class="btn">L∆∞u v√†o tr√¨nh duy·ªát</button>
              <button id="btnLoadLS" class="btn">Kh√¥i ph·ª•c t·ª´ tr√¨nh duy·ªát</button>
              <button id="btnRemoveAll" class="btn">üßπ Xo√° t·∫•t c·∫£ k·∫øt n·ªëi</button>
            </div>
            <p class="text-xs text-gray-500">L∆∞u √Ω: LocalStorage l∆∞u tr√™n m√°y ng∆∞·ªùi d√πng; khi ƒë·ªïi m√°y/tr√¨nh duy·ªát s·∫Ω kh√¥ng c√≤n.</p>
          </div>
        </div>

        <!-- Panel ph·∫£i (span 2 c·ªôt): Graph + Tooltip -->
        <div class="lg:col-span-2 space-y-4">
          <div id="cy" class="w-full rounded-xl border" style="height: 520px;"></div>
          <div id="tooltip"
               style="position:absolute; display:none; background:#fff; border:1px solid #ddd; padding:6px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.06); font-size:12px; max-width:420px; z-index:50;"></div>

          <div class="grid md:grid-cols-2 gap-4">
            <div class="card">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Centrality</h3>
                <select id="centrality-select" class="border rounded p-1 text-sm">
                  <option value="degree">degree</option>
                  <option value="betweenness">betweenness</option>
                  <option value="closeness">closeness</option>
                  <option value="eigenvector">eigenvector</option>
                  <option value="all">all</option>
                </select>
              </div>
              <canvas id="centrality-chart" style="height:260px"></canvas>
            </div>
            <div class="card">
              <h3 class="font-semibold">T·ªâ l·ªá I‚ÄìR‚ÄìM‚ÄìA</h3>
              <canvas id="irma-pie" style="height:260px"></canvas>
            </div>
          </div>

          <div class="card">
            <div class="flex items-center justify-between">
              <h3 class="font-semibold">Flow theo PLO (I ‚Üí R ‚Üí M ‚Üí A)</h3>
              <select id="plo-flow-select" class="border rounded p-1 text-sm">
                <option value="">-- Ch·ªçn m·ªôt PLO --</option>
              </select>
            </div>
            <div id="flow-diagram" class="mt-3"></div>
          </div>
        </div>
      </div>

      <!-- B·∫£ng ma tr·∫≠n & t√≥m t·∫Øt -->
      <div class="grid md:grid-cols-2 gap-4">
        <div class="card">
          <h3 class="font-semibold mb-2">Ma tr·∫≠n PLO √ó Course</h3>
          <div class="overflow-auto">
            <table id="matrixTable" class="min-w-full text-sm border border-gray-200">
              <thead class="bg-gray-100 sticky top-0"><tr><th>Course (fullname)</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <h3 class="font-semibold mb-2">T·ªïng h·ª£p s·ªë l∆∞·ª£ng I/R/M/A theo Course</h3>
          <div class="overflow-auto">
            <table id="summaryTable" class="min-w-full text-sm border border-gray-200">
              <thead class="bg-gray-100 sticky top-0">
                <tr><th>Course (fullname)</th><th>TC</th><th>I</th><th>R</th><th>M</th><th>A</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="text-xs text-gray-500 mt-2">‚ÄúTC‚Äù l√† s·ªë t√≠n ch·ªâ (n·∫øu b·∫°n mu·ªën hi·ªÉn th·ªã, hi·ªán m·∫∑c ƒë·ªãnh ƒë·ªÉ tr·ªëng).</p>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t">
    <div class="max-w-6xl mx-auto px-4 py-6 text-xs text-gray-500">
      ¬© 2025 ‚Äî Curriculum Matrices
    </div>
  </footer>

  <script src="./js/common.js"></script>
  <script src="./js/plo-course.js"></script>
  <script>window.__setActive && window.__setActive("plo-course");</script>
</body>
</html>
